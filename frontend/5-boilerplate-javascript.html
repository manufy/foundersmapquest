<html>

<head>
    <title>Bob's trycatch asessment</title>
    <!-- <link rel="stylesheet/less" type="text/css" href="assets/css/styles.less">  -->

    <link rel="stylesheet" href="assets/css/vendor/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/vendor/datatables/jquery.dataTables.min.css">
    <link rel="stylesheet" href="assets/css/vendor/datatables/dataTables.bootstrap.css">
    <link rel="stylesheet" href="assets/css/vendor/datatables/dataTables.responsive.css">
    <link rel="stylesheet" href="assets/css/vendor/datatables/dataTables.colReorder.min.css">
    <link rel="stylesheet" href="assets/css/vendor/humane/themes/libnotify.css"> 

    <!-- humane antes de require -->

    <script src="assets/js/vendor/humane.min.js"></script>

   
<!-- <script data-main="assets/js/main-angular.js" src="assets/js/require.js"></script>  -->

  <!--  <script src="src/foundersmapquest.js"></script>-->
    <script src="assets/js/vendor/jquery-2.1.3.min.js"></script>
    <script src="assets/js/vendor/jquery.dataTables.min.js"</script>
    <script src="assets/js/vendor/dataTables.bootstrap.js"></script>
    <script src="assets/js/vendor/dataTables.colReorder.js"></script>
    <script src="assets/js/vendor/dataTables.responsive.js"></script>

    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>

    <script>
        $(document).ready(function () {
            console.log("document ready");
            $('#demo').html('<table cellpadding="0" cellspacing="0" border="0" class="display" id="example"></table>');

            $('#example').dataTable({
                "data": dataSet,
                "dom": 'Rlfrtip',

                "columns": [
                    {
                        "title": "Select"
                    },
                    {
                        "title": "Id"
                    },
                    {
                        "title": "Company Name"
                    },
                    {
                        "title": "Founder"
                    },
                    {
                        "title": "City",
                        "class": "center"
                    },
                    {
                        "title": "Country",
                        "class": "center"
                    },
                    {
                        "title": "Postal Code"
                    },
                    {
                        "title": "Street"
                    },
                    {
                        "title": "Photo",
                        "class": "center"
                    },
                    {
                        "title": "Home Page",
                        "class": "center"
                    },
                    {
                        "title": "Garage Latitude",
                        "class": "center"
                    },
                    {
                        "title": "Garage Longitude",
                        "class": "center"
                    }
        ],
                "fnCreatedRow": function (nRow, aData, iDataIndex) {
                    $('td:eq(0)', nRow).html('<input type="checkbox" name="checkbox" class="checkbox" value="' + aData.Id + '">');
                    $('td:eq(5)', nRow).addClass('highlight');
                    $('td:eq(10)', nRow).addClass('latitudecolumn');
                    $('td:eq(11)', nRow).addClass('longitudecolumn');

                },
                "oColReorder": {
                    "fnReorderCallback": function () {
                        var colReorder = new $.fn.dataTable.ColReorder($('#example').dataTable());
                        console.log(colReorder);
                        //console.log($('#example').dataTable().oSettings);
                        //console.log(aoColumns);
                        console.log('Columns reordered');
                    }
                }

            });


        });





        var dataSet = [
    ['', '1', 'Google', 'Larry Page & Sergey Brin', 'Mountain View', 'USA', 'CA 94043', '1600 Amphiteatre Pkwy', 'http://photo', 'http://google.com', '37.1', '122.2'],
    ['', '2', 'Microsoft', 'Bill Gates', 'View', 'USA', 'CA 94043', '1660 Amphiteatre Pkwy', 'http://photo', 'http://google.com', '35.1', '121.2'],
    ['', '3', 'Apple', 'El Otro', 'Cupertino View', 'USA', 'CA 94023', '1620 Amphiteatre Pkwy', 'http://photo', 'http://google.com', '37.4', '124.2']

];

        console.log("initialize map")
        var map;

        function initialize() {
            var mapOptions = {
                zoom: 8,
                center: new google.maps.LatLng(37, 124.644)
            };
            map = new google.maps.Map(document.getElementById('map-canvas'),
                mapOptions);
        }

        google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    <style>
        .latitudecolumn {
            color: red;
        }
        
        .longitudecolumn {
            color: blue;
        }
        
        html,
        body,
        #map-canvas {
            height: 100%;
            margin: 0px;
            padding: 0px
        }
        
        #progress_bar {
            margin: 10px 0;
            padding: 3px;
            border: 1px solid #000;
            font-size: 14px;
            clear: both;
            opacity: 0;
            -moz-transition: opacity 1s linear;
            -o-transition: opacity 1s linear;
            -webkit-transition: opacity 1s linear;
        }
        
        #progress_bar.loading {
            opacity: 1.0;
        }
        
        #progress_bar .percent {
            background-color: #99ccff;
            height: auto;
            width: 0;
        }
    </style>


</head>

<body>




    <nav role="navigation" class="navbar navbar-default navbar-fixed-top">

        <!-- Brand and toggle get grouped for better mobile display -->

        <div class="navbar-header">
            <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="#" class="navbar-brand">Brand</a>
        </div>
        <!-- Collection of nav links and other content for toggling -->

        <div id="navbarCollapse" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Home</a>
                </li>
                <li><a href="#">Profile</a>
                </li>
                <li><a href="#">Messages</a>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li><a href="#">Login</a>
                </li>
            </ul>
        </div>
    </nav>


    <br>
    <br>
    <br>
    <br>

    <div role="tabpanel">

        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist">
            <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Home</a>
            </li>
            <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Profile</a>
            </li>
            <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Messages</a>
            </li>
            <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Settings</a>
            </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="home">1...</div>
            <div role="tabpanel" class="tab-pane" id="profile">2...</div>
            <div role="tabpanel" class="tab-pane" id="messages">3...</div>
            <div role="tabpanel" class="tab-pane" id="settings">4...</div>
        </div>

    </div>


    File:
    <input type="file" id="files" name="file" />
    <button onclick="abortRead();">Cancel read</button>
    <div id="progress_bar">
        <div class="percent">0%</div>
    </div>
    Result:
    <div id="tablecsv">
        <table>
        </table>
        <div>
            Table:
            <table id="example" class="table table-striped table-bordered" cellspacing="0">
            </table>

            <button id="viewtabledata" class="btn btn-primary">Ver datos en mapa</button>
            <br> Map:

            <div id="map-canvas">
            </div>


            <script>
                // Read CSV File

                var reader;
                var progress = document.querySelector('.percent');
                var csvOK = false;




                $('#viewtabledata').click(function () {
                    console.log("viewtabledta");
                    console.log(map);
                    var cells = [];
                    var lats = [];
                    var longs = [];
                    var rows = $("#example").dataTable().fnGetNodes();
                    for (var i = 0; i < rows.length; i++) {
                        // Get HTML of 3rd column (for example)
                        cells.push($(rows[i]).find("td:eq(2)").html());
                        lats.push($(rows[i]).find("td:eq(10)").html());
                        longs.push($(rows[i]).find("td:eq(11)").html());
                    }
                    console.log(cells);
                    console.log(lats);
                    console.log(longs);

                    for (i = 0; i < cells.length; i++) {

                        var myLatlng = new google.maps.LatLng(parseFloat(lats[i]), parseFloat(longs[i]));

                        var marker = new google.maps.Marker({
                            position: myLatlng,
                            map: map,
                            title: "Hello World!"
                        });
                        marker.setMap(map);
                    }



                });



                function abortRead() {
                    console.log("abortRead");
                    reader.abort();
                }

                function errorHandler(evt) {
                    console.log("errorHandler");
                    switch (evt.target.error.code) {
                    case evt.target.error.NOT_FOUND_ERR:
                        alert('File Not Found!');
                        break;
                    case evt.target.error.NOT_READABLE_ERR:
                        alert('File is not readable');
                        break;
                    case evt.target.error.ABORT_ERR:
                        break; // noop
                    default:
                        alert('An error occurred reading this file.');
                    };
                }

                function updateProgress(evt) {
                    console.log("updateProress");
                    // evt is an ProgressEvent.
                    if (evt.lengthComputable) {
                        var percentLoaded = Math.round((evt.loaded / evt.total) * 100);
                        // Increase the progress bar length.
                        if (percentLoaded < 100) {
                            progress.style.width = percentLoaded + '%';
                            progress.textContent = percentLoaded + '%';
                        }
                    }
                }

                function handleFileSelect(evt) {
                        // Reset progress indicator on new file selection.
                        console.log("handleFileSelect");
                        progress.style.width = '0%';
                        progress.textContent = '0%';
                        csvOK = false;

                        reader = new FileReader();
                        if (FileReader != "undefined") {
                            var regex = /^([a-zA-Z0-9\s_\\.\-:])+(.csv|.txt)$/;
                            console.log("csv test");
                            console.log(evt);
                            fileName = evt.target.files[0].name.toLowerCase();
                            fileExtension = fileName.split('.').pop().toLowerCase();
                            if (fileExtension == "csv") {
                                reader.onerror = errorHandler;
                                reader.onprogress = updateProgress;
                                reader.onabort = function (e) {
                                    alert('File read cancelled');
                                };
                                reader.onloadstart = function (e) {
                                    document.getElementById('progress_bar').className = 'loading';
                                    csvOK = false;
                                };
                                reader.onload = function (e) {
                                    // Ensure that the progress bar displays 100% at the end.
                                    progress.style.width = '100%';
                                    progress.textContent = '100%';
                                    setTimeout("document.getElementById('progress_bar').className='';", 2000);
                                    console.log("File loaded");



                                    // Render table

                                    // var table = $("<table />");
                                    console.log("build table from: " + e.target.res);

                                    var rows = e.target.result.split("\n");
                                    for (var i = 0; i < rows.length; i++) {
                                        console.log("row " + i + " start");
                                        var cells = rows[i].split(",");
                                        for (var j = 0; j < cells.length; j++) {
                                            cell = cells[j];
                                            console.log("row " + i + " append cell " + j + ": " + cell);
                                        }
                                        console.log("row end");
                                    }

                                    csvOK = true;
                                    onCSVLoaded(reader);

                                }
                            } else {
                                console.log("not a valid CSV file.");
                                alert("Please upload a valid CSV file.");
                            }
                        } else {
                            console.log("browser don't support HTML5.");
                            alert("This browser does not support HTML5.");
                        }

                        // Read in the image file as text string.

                        reader.readAsText(evt.target.files[0]);
                        //console.log("File readed reader:");
                        //console.log(reader);


                        // try to parse it

                    } // END handleFileSelect

                function onCSVLoaded(reader) {
                    console.log("onCSVLoaded")
                    console.log("File readed reader:");
                    console.log("csvOK: " + csvOK);
                }

                console.log("settingListener");
                document.getElementById('files').addEventListener('change', handleFileSelect, false);
            </script>





</body>

</html>